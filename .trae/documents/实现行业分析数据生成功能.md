## 实现计划：行业分析数据生成（e_fund_ana.py）

### 功能概述
从`bao_stock_basic`表按行业聚合股票代码，查询最新交易数据和PE分位值，计算行业平均指标，写入`fund_ana`表。

### 实现步骤

#### 1. 文件初始化
- 导入必要的模块：`sys`, `os`, `logging`, `sqlalchemy`
- 配置logger（不调用`logging.basicConfig()`，避免冲突）
- 添加项目路径到sys.path

#### 2. 创建Flask应用上下文
- 定义`init_app_context()`函数，初始化Flask应用和数据库连接
- 参考现有代码`d_stock_ana_data.py`的实现方式

#### 3. 定义FundAna模型（在app.py中）
- 在`app.py`中添加`FundAna`模型类
- 对应`fund_ana`表的所有字段

#### 4. 实现核心函数`fund_ana_data_gen()`
- **步骤4.1**：查询`bao_stock_basic`表，按`industry`分组聚合所有股票代码
- **步骤4.2**：对每个行业：
  - 提取所有code并排序，用逗号连接存入`all_stock`
  - 从`bao_stock_trade_0`到`bao_stock_trade_9`查询每个code的最新交易数据
  - 按`total_market_value`排序，取TOP股票存入`top_stock`
- **步骤4.3**：计算PE分位值平均值
  - 查询每个code的最新`pe_year_1_percent`, `pe_year_3_percent`, `pe_year_5_percent`, `pe_year_10_percent`
  - 计算所有code的平均值，存入`fund_ana`表对应字段
- **步骤4.4**：使用`INSERT ... ON DUPLICATE KEY UPDATE`或Flask-SQLAlchemy的upsert模式写入数据

#### 5. 主函数入口
- 添加`if __name__ == "__main__"`入口
- 调用`fund_ana_data_gen()`并记录日志

### 涉及文件
1. **新建/修改**：`d:/workspace_2/stock_an/bao/gen_data/e_fund_ana.py`
2. **修改**：`d:/workspace_2/stock_an/app.py`（添加FundAna模型）

### 技术要点
- 使用SQLAlchemy的`text()`执行原生SQL查询
- 使用Flask应用上下文访问数据库
- 处理多表查询（bao_stock_trade_0到bao_stock_trade_9）
- 使用`UNION ALL`或循环查询合并多个分表数据
- 计算平均值时过滤NULL值